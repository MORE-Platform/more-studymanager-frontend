# Manual integration Test for Relative Scheduler Feature

### Background:
- Study was created or exists.

## Realtive Scheduler in SMF

| **Scenario**                                                                                                                      | **Given**                                                                                                                                                     | **Steps**                                                                                                                                                                                                                                  | **Expected Result**                                                                                                                                                                                                                                                                                                   | **Result**     | **Notes**                                                                                                                                                                                              |
|-----------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Open relative schedule dialog                                                                                                     | Observation Dialog is open                                                                                                                                    | <ul><li>WHEN I click on the button 'Add relative Schedule', </li></ul>                                                                                                                                                                     | THEN the 'Manage relative schedule' dialog opens.                                                                                                                                                                                                                                                                     | 21.11.2023: ✅  | Wording improvement implemented:<ul><li><s>changed wording to Starts on day 3 / Ends on day 3 instead of starts on 3 day(s) / Ends on 3 day(s)</li></ul> |
| 'Save' start and end from 'Managae relative Schedule' dialog.                                                                     | Manage relative schedule dialog is open.                                                                                                                      | <ul><li> WHEN I set 'Starts on' 'Date' to 'Day 2' </li><li> AND  the 'Starts on' 'Time' to '09:00',</li><li> AND the 'Ends on' to 'Day 3' </li><li> AND the 'Ends on' 'Time' to '18:00',</li><li> AND click the 'Save' Button,</li></ul>   | THEN the 'Manage relative schedule' dialog should close and the observation dialog should display the preview for 'Individual Event' under Scheduler with the entered values (Starsts on: Day 2, 9:00; Ends on: Day 3, 18:00).                                                                                        | 21.11.2023: ✅                | -                                                                                                                                                                                                      |
| 'Save' observation with simple relative schedule.                                                                                 | Manage relative schedule dialog is open<br> and the values for starts on and ends on are already entered ('Starst on': Day 2, 9:00; 'Ends on': Day 3, 18:00). | <ul><li>WHEN I fill out all required fields for the observation</li><li>AND click 'Save' on the 'observation dialog'</li></ul>                                                                                                             | THEN the Observation List shown should update and show now the new created observation with the Schedule data: 'Type': Relative, 'Start': Day 2, 9:00; 'End': Day 3, 18:00                                                                                                                                            | 21.11.2023: ✅                | Wording improvement implemented:<br><ul><li><s>Schedule Type is displayed as: 'RelativeEvent'. Inserted a translation for Event and RelativeEvent Enums</li></ul>                                         |
| Check schedule data inside the observation dialog of observation in observation list, that has a relative schedule.               | Observation list does have already an item inside the list that has a relative schedule.                                                                      | <ul><li>WHEN i click on an observation in the list, that has a relative schedule</li></ul>                                                                                                                                                 | THEN the observatin dialog opens and shows the exact same data displayed inside the list for the schedule preview.                                                                                                                                                                                                    | 21.11.2023: ✅               | -                                                                                                                                                                                                      |
| Check schedule data inside the 'Manage relative Schedule' dialog of observation in observation list, that has a relative schedule | Observation list does have already an item inside the list that has a relative schedule.                                                                      | <ul><li>WHEN I click on an observation in the list, that has a relative schedule</li><li>AND click on the 'EDIT relative schedule' button on the observation dialog</li></ul>                                                              | THEN the 'Manage relative schedule' dialog opens and shows the exact same data displayed inside the observation list for the scheduler values.                                                                                                                                                                        |21.11.2023: ✅                | -                                                                                                                                                                                                      |
| Cancel start and end from 'Manage relative Schedule' dialog.                                                                      | Manage relative schedule dialog is open. No schedule was saved for that specific observation yet.                                                             | <ul><li> WHEN I set 'Starts on' 'Date' to 'Day 2' </li><li> AND  the 'Starts on' 'Time' to '09:00',</li><li> AND the 'Ends on' to 'Day 3' </li><li> AND the 'Ends on' 'Time' to '18:00',</li><li> AND click the 'Cancel' Button,</li></ul> | THEN the 'Manage relative schedule' dialog should close and and the observation dialog should display no preview for the scheduled time. The default information text is displayed underneath of the Schedule title.                                                                                                  |  21.11.2023: ✅              | -                                                                                                                                                                                                      |
| Update relative schedule and add repetition.                                                                                      | Observation dialog is open and has already a relative schedule (initial values: 'Starst on': Day 2, 10:30; 'Ends on': Day 2, 18:30).                          | <ul><li>WHEN I click on "Edit relative schedule'</li><li>AND check 'repeat event'</li><li>AND set repeat every to 2</li>AND set end after to 9</li><li>AND click on save</ul>                                                              | THEN the observation dialog should list the individual event with Starts on Day 2, 10:30 and Ends on Day 2, 18:30, and the repeat event with Every 2 day(s) and ends on Day 9.                                                                                                                                        | 21.11.2023: ✅                | -                                                                                                                                                                                                      |
| Updating calculations when editing 'repeat event'  | Manage relative schedule dialog is open. <br> Initial values entered: 'Starts on': 2 day, 10:30; 'Ends on': 2 day, 18:30                                                                                                                     | <ul><li> WHEN I click the 'repeat event checkbox'</li><li> and enter 2 into the field next to 'Repeat every' </li><li> AND  select I select 9 into the input field next to 'End after'</li>                                                | THEN the information displayed right to the repetition values show Repeated: 5 times, End's 10 days after individual study start.                                                                                                                                                                                     | 21.11.2023: ✅               |                                                                                                                                                                                                        |
| Updating calculations when editing 'repeat event', when changing the unit value.                                                  | Manage relative schedule dialog is open and for starts on and ends on are already inital values entered ('Starst on': Day 2, 9:00; 'Ends on': Day 3, 18:00).  | <ul><li> WHEN I select a different unit in the dropdown for either repeat every and/or end after </li></ul>                                                                                                                                | THEN the information on the right side is calculated anew based on the new values.                                                                                                                                                                                                                                    | 21.11.2023: ✅                | -                                                                                                                                                                                                      |
| Remove relative scheduler from observation dialog.                                                                                | Observation dialog is open and has already an realtive schedule entered in.                                                                                   | <ul><li>WHEN I click the button 'Remove scheduler'</li></ul>                                                                                                                                                                               | THEN the scheduler values should have been deleted from the observation, the preview is gone and the default information text is displayed again.                                                                                                                                                                     |  21.11.2023: ✅               | -                                                                                                                                                                                                      |
| Save the observation with no preentered schedule.                                                                                 | Observation dialog is open and the required fields are filled in, except a defined scheduler.                                                                 | <ul><li>WHEN I click the save button on the observation dialog</ul></li>                                                                                                                                                                   | THEN the observation dialog closes and saves the observation with the planned start and planned end of the study as absolute schedule for the observation. The observation list shows the created observation with the Schedule Type Event and the planned start and planned end as start and end of the observation. |  21.11.2023: ✅               | -                                                                                                                                                                                                      |


## ICal Export / More App

### Background:
- Study was crated with a study duration of 10 days.

### Observaion Background:
| Observation                                                           | Schedule Type | Start             | End                            | Repetition: Every | Repetition: days    | Repetition: ends     | **Result Ical Output**                                                         | **Note**                                                                                                                                                                                                                         |
|-----------------------------------------------------------------------|---------------|-------------------|--------------------------------|-------------------|---------------------|----------------------|--------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Simple Question: Absolute (no repetition)                             | Absolute      | current day, 8:00 | 26.11.2023, 18:00              | -                 | -                   | -                    | 21.11.2023: ✅                                                                  |                                                                                                                                                                                                                                  |
| Simple Question: 'Absolute: daily for 10 days'                        | Absolute      | 23.11.2023, 8:00  | 14:00 (Individual Observation) | daily             | -                   | after 10 days        | 21.11.2023: ✅                                                                  |                                                                                                                                                                                                                                  |
| Simple Question: 'Absolute: weekly (Mo, Fr) for 20 weeks'             | Absolute      | 23.11.2023, 16:00 | 18:00 (Individual Observation  | Weekly            | Mo, Fr              | 20 weeks (40 times)  | <s>21.11.2023: Bugreport</s><br/><br/>22.11.2023: ✅                | <s>21.11.2023 BUG: If absolute schedule repetition goes beyond the study duration, the observation schedule is sshown inside the ICal until repetition ends, ignoring the study end date</s><br/><br/>22.11.2023: Bug was fixed. |
| Simple Question: 'Absolute (repetition: weekly, until end of study)'  | Absolute      | 21.11.2023, 08:00 | 12:00 (Individual Observation  | MO, WE, FR        | Until end of study  |                      | 21.11.2023: ✅                                                                  |                                                                                                                                                                                                                                  |
| Simple Question: 'Relative (no repetition)'                           | Relative      | Day 2, 12:00      | Day 4, 13:00                   | -                 | -                   | -                    | 20.11.2023: Time Bug                                                           | <s>TIME BUG: Time is set one hour after sceduled time -> 13:00, 14:00 </s> <br/> <br/>22.11.2023: Bug was fixed                                                                                                                  |
| Simple Question: 'Relative (repetition: 3 days, after 12 times)'      | Relative      | Day 3, 6:00       | Day 3, 18:00                   | 3 days            | -                   | 35 day(s) (12 times) | 21.11.2023: It stops after study duration ended ✅ <br><br>21.11.2023: Time Bug | <s>same as above                                                                                                                                                                                                                 |
| Simple Question: 'Relative (repetition: 1 hour, after 32 times)'      | Relative      | Day 4, 6:15       | Day 4, 6:30                    | 1 hour            | -                   | 32 hours (32 times)  | 21:11.2023: It repeates 32 times ✅<br><br>21.11.2023: Time Bug                 | <s> same as above                                                                                                                                                                                                                |
| Simple Question: 'Relative (repetition: 1 min, after 1 hour)'         | Relative      | Day 1, 7:00       | Day 1, 7:01                    | 1 min             |-                    | 1 hour               | 21:11.2023: It repeates 60 times ✅<br><br>21.11.2023: Time Bug                 | <s>same as above                                                                                                                                                                                                                 |

### Testing Scenarios / Results
| **Scenario**                                                             | **Given**                                        | **Steps**                                                                                                                                                                    | **Expected Result**                                                                                                                                                             | **Result**                           | **Note**                                                                                                                                                                                                                  |
|--------------------------------------------------------------------------|--------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Check ICal export after creating several observations                    | see background info                              | <ul><li>WHEN I have configered all in background listed observations</li><li>AND click on the Ical export of the study</li></ul>                                             | THEN a Ical export data is downloaded, that shows (after import into outlook) all the observations in correct order.                                                            | 21.11.2023: BUG<br/><br/>22.11.2023: | 21.11.2023:<br/><ul><li><s>BUG: Absolute Scheduler shows in Observation List End, the start time</s></li><li><s>BUG: Time of relative schedule has a offset of 1 hour</s></li></ul><br/><br/>2022.11.2023: Bug was fixed. |
| Check if App Observations are scheduled the same way as the ICal export. | see background info<br>Ical was already exported | <ul><li>WHEN I have configered all in background listed observations</li><li>AND have checked the ICal exprt</li><li>AND have logged into the study as participant</li></ul> | THEN the active observations are scheduled and shown based on the observation settings. The scheduled observations on the app have the same dates and times as the Ical export. | 22.11.2023: BUG                      | 21.11.2023: BUG If you log in for the first time the schedule is empty. After study is paused and resumed on the study manager the schedules are shown.                                                                   |

Download ical without button: https://data.platform-test.more.redlink.io/api/v1/calendar/studies/[STUDY-ID]/calendar.ics

Studymanager App Backend-Test - Study-Endpoint: https://data.platform-test.more.redlink.io/api/v1

### More App: Additional Observation examples

<em> Just some more examples for observation settings -  use if needed - initial test is </em>

### Background SMF Configuration
- Study planned start: before 21:11.2023
- Study planned end: 31.12.2023

|Observation|Schedule Type| Start              | End           | Repetition: Every |Repetition: days| Repetition: ends |
|---|---|--------------------|---------------|-------------------|---|------------------|
|Simple Question|Absolute| current day, 8:00  | 25.11.2023, 18:00 | -                 |-| -                |
|Simple Question|Absolute| current day, 9:00  | current day, 10:00 | daily             |-| after 10 days    |
|Simple Question|Absolute| current day, 12:00 | current day, 13:00 | weekly            |MO, TUE| after 3 weeks    |
|Simple Question|Relative| Day 1, 15:00       | Day 2, 19:00  | -                 |-| -                |
|Simple Question|Relative| Day 2, 7:00        |Day 2,7:15| 1 hour            |-| 12 hours         |
|Simple Question|Relative| Day 4, 8:00        |Day 5,10:00|3 day|-|20 days|

## App: Study Ends automatically for relative study duration

 | **Scenario**                                                                   | **Given**                                                                                                                                                                                                                                              | **Steps**                                                                                            | **Expected Result**                                                                                                                                                                    | **Result**    | **Note**                                                                                                                       |
|--------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|--------------------------------------------------------------------------------------------------------------------------------|
| Check if study ends automatically for relative scheduled study & observations. | Study was configured with duration: 1 minute and some participants were created. <br>Current app was installed on a mobile device.                                                                                                                     | <ul><li>WHEN I log in as a participant into the configured study with duration of 1 minute</li></ul> | THEN the study closes after 1 minute and sends a message to the participant that the study is over now. The More-App should show only the end message on the schedule overview screen. | 22.11.2023: ✅ | |
|Check if data is collected and study ends automatically. | Study was configured with a  duration of 10 minutes and some participants were created.<br> Study has a Question observation with start: current day & time and end: current day & time + 30 minutes.<br>Current app was installed on a mobile device. |<ul><li>WHEN i log in as a participant into the study</li><li>AND answer the question observation</li><li>AND wait for 10+ minutes</li></ul>|THEN the study has recieved my answer data in the backend AND has closed after 10 minutes on the app.| 22.11.2023: ✅    ||


## SMF Compatibility
| **Scenario**                                                               | **Given**                                                                                                                                           | **Steps**                                                                                                                                                                             | **Expected Result**                                                                                                                        | **Result**         | **Note** |
|----------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|--------------------|----------|
| Check if the backend works with the original frontend without the feature. | A study was created with participants, <br>1-2 study grousp, <br>and 1-2 observations each for absolute and relative schedule (see examples above). | <ul><li>AFTER the study was created as described</li><li>AND I check out the former development status from the Main branch</li><li>AND run it locally with the current SMB</li></ul> | THEN the Study Manager frontend should run without errors on study overview, study group list, observations (+scheduler) or interventions. | 22.11.2023: FAILED | Error:<br/> <br/>  "JSON parse error: Could not resolve subtype of [simple type, class io.redlink.more.studymanager.api.v1.model.ObservationScheduleDTO]: missing type id property 'type' (for POJO property 'schedule')"||
|

